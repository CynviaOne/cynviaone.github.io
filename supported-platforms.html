<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>CynviaOne — Supported platforms</title>

<!-- Roboto + Material Symbols Rounded (same as your file) -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500,700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,600,1,0" rel="stylesheet">

<style>
:root{--bg:#fbf9fb;--card:#e6e4e7;--muted:#6d6c6d;--title:#0b0b0b;--accent:#3f5f90;--radius:18px;--max-w:380px;--icon-size-lg:28px;--icon-slot:48px;--gap-22:18px}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:var(--bg);font-family:"Roboto",system-ui,Arial;color:var(--title);-webkit-font-smoothing:antialiased}
.wrap{max-width:var(--max-w);margin:8px auto;padding:8px 12px 40px}
.material-rounded{font-family: 'Material Symbols Rounded';font-variation-settings: "FILL" 1, "wght" 600, "GRAD" 0, "opsz" 40;display:inline-block;line-height:1;vertical-align:middle}
.icon-md{font-size:var(--icon-size-lg)}
.topbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px}.left{display:flex;align-items:center;gap:8px}
.btn-close{background:transparent;border:0;padding:0;margin:0;font-size:18px;cursor:pointer;color:var(--title);display:inline-flex;align-items:center;justify-content:center}
.logo{font-weight:700;font-size:20px;line-height:1}.logo .one{color:var(--accent);font-weight:600}
.actions{display:flex;gap:12px;align-items:center}.action-icon{background:transparent;border:0;padding:6px;font-size:24px;cursor:pointer;color:var(--title)}
.page-header{padding:16px 2px 20px}.page-header h1{margin:0 0 8px;font-size:36px;font-weight:700;line-height:1.05}
.page-header .subtitle{margin:0 0 12px;font-size:16px;font-weight:600;color:var(--title)}
.page-header .description{margin:0;font-size:14px;line-height:1.4;color:var(--title);opacity:0.85;font-weight:400}

/* card list */
.profile-section{background:var(--card);border-radius:var(--radius);padding:6px;margin-bottom:var(--gap-22)}
.profile-item{display:flex;align-items:center;gap:14px;padding:14px;cursor:default;transition:all 0.15s ease;position:relative}
.profile-item + .profile-item::before{content:"";display:block;position:absolute;left:0;right:0;height:2px;top:0;background:var(--bg)}
.profile-item .icon{width:var(--icon-slot);height:var(--icon-slot);display:flex;align-items:center;justify-content:center;flex-shrink:0;border-radius:12px;background:#fff;box-shadow:0 0 0 1px rgba(0,0,0,0.03)}
.profile-item .content{flex:1;min-width:0}
.profile-item h3{margin:0 0 3px;font-size:16px;font-weight:700}
.profile-item p{margin:0;font-size:13px;color:var(--muted);font-weight:500}
.btn-link{padding:8px 16px;border-radius:999px;border:none;font-size:14px;font-weight:700;cursor:pointer;transition:all .12s ease;background:#000;color:#fff}
.btn-unlink{padding:8px 14px;border-radius:999px;border:1px solid rgba(0,0,0,0.08);font-size:14px;font-weight:700;cursor:pointer;transition:all .12s ease;background:transparent;color:var(--title)}

/* tick */
.tick{display:inline-flex;align-items:center;justify-content:center;border-radius:50%;width:28px;height:28px;background:#12c76a;color:#fff;font-weight:700;margin-left:10px;flex-shrink:0}

/* looking else */
.more{font-size:14px;font-weight:700;margin-top:8px;margin-bottom:10px;padding-left:2px}

/* loading */
.loading-container {display:flex;flex-direction:column;align-items:center;justify-content:center;padding:30px 20px;margin:12px 0}
.spinner {width:34px;height:34px;border:4px solid transparent;border-top:4px solid #000;border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin {0%{transform:rotate(0)}100%{transform:rotate(360deg)}}

/* responsive */
@media (max-width:420px){:root{--max-w:100%}.wrap{padding-left:10px;padding-right:10px}}
</style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="left">
        <button class="btn-close" aria-label="Go back" onclick="goBack()">
          <span class="material-rounded icon-md">arrow_back</span>
        </button>
        <div class="logo">Cynvia<span class="one">One</span></div>
      </div>
      <div class="actions">
        <button class="action-icon" title="Help" aria-label="Help" onclick="window.location.href='mailto:support.cynviaone@outlook.com'">
          <span class="material-rounded icon-md">help</span>
        </button>
      </div>
    </div>

    <div class="page-header">
      <h1>Supported platforms</h1>
      <p class="subtitle">Manage and connect your account with third-party services.</p>
      <p class="description">Linking supported platforms allows you to sign in faster, sync data, and enhance your experience across different apps and services.</p>
    </div>

    <!-- Loading -->
    <div id="loadingContainer" class="loading-container" role="status" aria-live="polite">
      <div class="spinner" aria-hidden="true"></div>
    </div>

    <!-- Main -->
    <div id="mainContent" style="display:none;">
      <div class="profile-section" id="platformList">
        <!-- platform items injected by JS -->
      </div>

      <div class="more">looking for something else?</div>

      <div class="profile-section">
        <div class="profile-item" onclick="window.location.href='about.html'">
          <div class="icon"><span class="material-rounded">info</span></div>
          <div class="content"><h3>About CynviaOne</h3><p>Learn more about CynviaOne</p></div>
        </div>
        <div class="profile-item" onclick="window.location.href='mailto:support.cynviaone@outlook.com?subject=Feedback'">
          <div class="icon"><span class="material-rounded">feedback</span></div>
          <div class="content"><h3>Send feedback</h3><p>Share your thoughts with us</p></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase compat scripts (same used in your file) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
  /***************************************
   * IMPORTANT: This file uses your Firebase config (copied from your uploaded file).
   * I used the exact config present in your uploaded personalinfo file.
   *
   * Note: For OAuth providers (GitHub / Microsoft / Apple) to work you must enable them
   * and add client IDs / secrets in the Firebase Console (Authentication → Sign-in method).
   ***************************************/

  // --- Firebase config (from your uploaded file) ---
  const firebaseConfig = {
    apiKey: "AIzaSyDaRo6aKcg5Tju7spWUtLKOUBEItUpgF90",
    authDomain: "ouruiofficial.firebaseapp.com",
    projectId: "ouruiofficial",
    storageBucket: "ouruiofficial.firebasestorage.app",
    messagingSenderId: "513335403025",
    appId: "1:513335403025:web:b965e1187d5386d52d87b0",
    measurementId: "G-X5QWNP8DMK"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // providers definitions (providerId => { label, company, providerObj })
  const PLATFORM_LIST = [
    { id: 'google.com', label: 'Google', company: 'Google LLC', providerFactory: () => new firebase.auth.GoogleAuthProvider(), logo: 'google' },
    { id: 'microsoft.com', label: 'Microsoft', company: 'Microsoft Corporation', providerFactory: () => new firebase.auth.OAuthProvider('microsoft.com'), logo: 'microsoft' },
    { id: 'github.com', label: 'GitHub', company: 'GitHub, Inc.', providerFactory: () => new firebase.auth.GithubAuthProvider(), logo: 'github' },
    { id: 'apple.com', label: 'Apple', company: 'Apple Inc.', providerFactory: () => new firebase.auth.OAuthProvider('apple.com'), logo: 'apple' }
  ];

  // current user + listener
  let currentUser = null;
  let unsubscribeUserDoc = null;
  let initialDataLoaded = false;
  const minLoading = 500;

  function goBack(){ if (window.history.length>1) window.history.back(); else window.location.href='index.html'; }

  // render platform list
  function renderPlatforms(userDocData){
    const list = document.getElementById('platformList');
    list.innerHTML = '';
    const linked = (userDocData && userDocData.linkedProviders) ? userDocData.linkedProviders : [];

    PLATFORM_LIST.forEach(p => {
      const item = document.createElement('div');
      item.className = 'profile-item';
      item.id = 'plat-'+p.id;

      // icon / logo (simple inline svgs for brand look)
      const icon = document.createElement('div');
      icon.className = 'icon';
      icon.innerHTML = getLogoSVG(p.logo);
      item.appendChild(icon);

      const content = document.createElement('div');
      content.className = 'content';
      const title = document.createElement('h3');
      title.textContent = p.label + (p.company ? (' — ' + p.company) : '');
      const subtitle = document.createElement('p');
      subtitle.textContent = p.company || '';
      content.appendChild(title);
      content.appendChild(subtitle);
      item.appendChild(content);

      // right side: show tick if linked, and button
      const rightWrap = document.createElement('div');
      rightWrap.style.display = 'flex';
      rightWrap.style.alignItems = 'center';
      rightWrap.style.gap = '8px';

      if (linked.includes(p.id)) {
        const tick = document.createElement('div');
        tick.className = 'tick';
        tick.innerHTML = '✓';
        rightWrap.appendChild(tick);
      } else {
        const spacer = document.createElement('div');
        spacer.style.width = '28px';
        rightWrap.appendChild(spacer);
      }

      const btn = document.createElement('button');
      btn.className = linked.includes(p.id) ? 'btn-unlink' : 'btn-link';
      btn.textContent = linked.includes(p.id) ? 'Unlink' : 'Link';
      btn.onclick = function(e){
        e.stopPropagation();
        if (linked.includes(p.id)) {
          unlinkProvider(p.id);
        } else {
          linkProvider(p);
        }
      };
      rightWrap.appendChild(btn);

      item.appendChild(rightWrap);
      list.appendChild(item);
    });
  }

  // provider logos (small inline svgs)
  function getLogoSVG(name){
    if (name === 'google') {
      return `<svg width="36" height="36" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path d="M44 24.5c0-1.3-.1-2.6-.3-3.8H24v7.2h11.9c-.5 2.8-2.1 5.2-4.4 6.8v5.6h7c4.1-3.8 6.4-9.4 6.4-15.8z" fill="#4285F4"/>
        <path d="M24 44c5.9 0 10.9-1.9 14.5-5.2l-7-5.6c-2 1.4-4.6 2.3-7.5 2.3-5.8 0-10.7-3.9-12.5-9.2H4.4v5.8C7.9 38.9 15.3 44 24 44z" fill="#34A853"/>
        <path d="M11.5 26.3c-.5-1.4-.8-2.9-.8-4.3s.3-2.9.8-4.3V12.0H4.4C2 15.9 0 20.6 0 24s2 8.1 4.4 12l7.1-5.7z" fill="#FBBC05"/>
        <path d="M24 9.6c3.2 0 6.1 1.1 8.4 3.2l6.3-6.3C34.9 3.1 29.9 0 24 0 15.3 0 7.9 5.1 4.4 12l7.1 5.8C13.3 13.5 18.2 9.6 24 9.6z" fill="#EA4335"/>
      </svg>`;
    }
    if (name === 'github') {
      return `<svg width="36" height="36" viewBox="0 0 24 24" aria-hidden="true"><path fill="#111" d="M12 0a12 12 0 00-3.8 23.4c.6.1.8-.3.8-.6v-2c-3.3.7-4-1.6-4-1.6-.5-1.4-1.2-1.8-1.2-1.8-1-.7.1-.7.1-.7 1.1.1 1.7 1.1 1.7 1.1 1 .1 1.6.7 1.9 1.1.5.8 1.3 1.1 2 .9.1-.7.4-1.1.8-1.4-2.6-.3-5.3-1.3-5.3-5.9 0-1.3.5-2.4 1.2-3.2-.1-.3-.5-1.6.1-3.3 0 0 1-.3 3.4 1.2 1-.3 2-.5 3-.5s2 .2 3 .5c2.4-1.6 3.4-1.2 3.4-1.2.6 1.7.2 3 .1 3.3.8.8 1.2 1.9 1.2 3.2 0 4.6-2.6 5.6-5.3 5.9.4.3.8 1 .8 2v3c0 .3.2.7.8.6A12 12 0 0012 0z"/></svg>`;
    }
    if (name === 'microsoft') {
      return `<svg width="36" height="36" viewBox="0 0 24 24" aria-hidden="true"><rect x="1" y="1" width="10" height="10" fill="#F25022"/><rect x="13" y="1" width="10" height="10" fill="#7FBA00"/><rect x="1" y="13" width="10" height="10" fill="#00A4EF"/><rect x="13" y="13" width="10" height="10" fill="#FFB900"/></svg>`;
    }
    if (name === 'apple') {
      return `<svg width="36" height="36" viewBox="0 0 24 24" aria-hidden="true"><path fill="#111" d="M16.365 1.43c-.9.06-2.1.64-2.77 1.42-.6.7-1.08 1.73-1.08 2.77 0 .09 0 .18.01.27 1.22.03 2.46-.62 3.26-1.43.74-.75 1.26-1.8 1.28-2.74-.01-.06-.01-.11-.01-.19zM21.79 9.41c-.02-2.72 1.12-4.78 3.14-6.29-1.13-1.36-2.83-2.12-4.53-2.12-1.87 0-3.6.77-4.86 1.97-1.24 1.17-2.01 2.92-1.72 4.83.09.58.25 1.12.46 1.6.35.78.9 1.44 1.61 1.98.85.63 1.71.95 2.38 1.15.97.29 1.78.03 2.12-.28.46-.45.57-1.35.2-2.24-.36-.89-1.15-1.73-2.02-2.08z"/></svg>`;
    }
    // fallback
    return `<span class="material-rounded">account_circle</span>`;
  }

  // link provider (link to current signed-in user)
  function linkProvider(platform){
    if (!currentUser){
      alert('Please sign in first.');
      return;
    }
    const provider = platform.providerFactory();
    // request typical scopes for GitHub or Microsoft if needed:
    if (platform.id === 'github.com') {
      provider.addScope('read:user');
      provider.addScope('user:email');
    }
    if (platform.id === 'microsoft.com') {
      // example: provider.setCustomParameters({ prompt: 'consent' })
    }
    // Use linkWithPopup to attach to the existing account
    currentUser.linkWithPopup(provider).then(result => {
      // add to Firestore linkedProviders array
      db.collection('users').doc(currentUser.uid).set({
        linkedProviders: firebase.firestore.FieldValue.arrayUnion(platform.id),
        updatedAt: new Date().toISOString()
      }, { merge: true });
    }).catch(err => {
      // if account-exists-with-different-credential or requires sign-in, inform user
      console.error('Link failed', err);
      if (err && err.code === 'auth/provider-already-linked') {
        alert(platform.label + ' is already linked.');
      } else if (err && err.code === 'auth/credential-already-in-use') {
        alert('This ' + platform.label + ' account is already linked to another user.');
      } else {
        alert('Failed to link ' + platform.label + ': ' + (err.message || err));
      }
    });
  }

  // unlink provider
  function unlinkProvider(providerId){
    if (!currentUser) return;
    if (!confirm('Unlink this provider?')) return;
    currentUser.unlink(providerId).then(() => {
      // update Firestore
      db.collection('users').doc(currentUser.uid).set({
        linkedProviders: firebase.firestore.FieldValue.arrayRemove(providerId),
        updatedAt: new Date().toISOString()
      }, { merge: true });
    }).catch(err => {
      console.error('Unlink failed', err);
      alert('Failed to unlink: ' + (err.message || err));
    });
  }

  // attach realtime user doc
  function attachRealtimeUserDoc(uid){
    if (!uid) return;
    const ref = db.collection('users').doc(uid);
    if (unsubscribeUserDoc) { try { unsubscribeUserDoc(); } catch(e){}; unsubscribeUserDoc=null; }
    unsubscribeUserDoc = ref.onSnapshot(snap => {
      const data = snap.exists ? snap.data() : {};
      renderPlatforms(data);
      // hide loading first time
      if (!initialDataLoaded) {
        initialDataLoaded = true;
        setTimeout(()=>{ document.getElementById('loadingContainer').style.display='none'; document.getElementById('mainContent').style.display='block'; }, minLoading);
      }
    }, err => {
      console.error('Realtime user doc error', err);
      renderPlatforms({});
    });
  }

  // auth state
  auth.onAuthStateChanged(user => {
    if (unsubscribeUserDoc) { try { unsubscribeUserDoc(); } catch(e){}; unsubscribeUserDoc=null; }
    currentUser = user || null;
    if (currentUser) {
      // Ensure user doc exists
      const uref = db.collection('users').doc(currentUser.uid);
      uref.set({ uid: currentUser.uid, displayName: currentUser.displayName || null }, { merge: true }).catch(()=>{});
      attachRealtimeUserDoc(currentUser.uid);
    } else {
      // not signed in - redirect to your signin flow (same as your file)
      window.location.replace('signin.html');
    }
  });

  // init UI: create placeholders while loading
  document.addEventListener('DOMContentLoaded', function(){
    const list = document.getElementById('platformList');
    list.innerHTML = '';
    PLATFORM_LIST.forEach(p => {
      const ph = document.createElement('div');
      ph.className = 'profile-item';
      ph.innerHTML = `
        <div class="icon">${getLogoSVG(p.logo)}</div>
        <div class="content"><h3>${p.label} — ${p.company}</h3><p>${p.company}</p></div>
        <div style="display:flex;align-items:center;gap:8px"><div style="width:28px;height:28px"></div><button class="btn-link">Link</button></div>
      `;
      list.appendChild(ph);
    });
    // keep loading spinner visible until realtime data arrives
  });

  </script>
</body>
</html>
