<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OurUI - Sign Up</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #f0f0f0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            min-height: 100vh;
            padding: 60px 40px;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
        }

        .logo {
            font-size: 48px;
            font-weight: 700;
            color: #000;
            margin-bottom: 16px;
            text-align: center;
            letter-spacing: -1px;
            transition: all 0.5s ease;
        }

        .subtitle {
            font-size: 18px;
            color: #666;
            margin-bottom: 80px;
            font-weight: 400;
            text-align: center;
            transition: all 0.5s ease;
        }

        .signup-title {
            font-size: 52px;
            font-weight: 700;
            margin-bottom: 60px;
            color: #000;
            text-align: left;
            transition: all 0.5s ease;
        }

        .signup-title .up {
            color: #4a6fa5;
        }

        .form-container {
            transition: all 0.5s ease;
        }

        .form-group {
            margin-bottom: 20px;
            opacity: 1;
            transform: translateX(0);
            transition: all 0.5s ease;
        }

        .form-group.hidden {
            opacity: 0;
            transform: translateX(-100%);
            height: 0;
            margin-bottom: 0;
            overflow: hidden;
        }

        .form-group.slide-in-right {
            opacity: 0;
            transform: translateX(100%);
        }

        .form-group.slide-in-right.show {
            opacity: 1;
            transform: translateX(0);
        }

        .input-field {
            width: 100%;
            padding: 24px 28px;
            border: none;
            border-radius: 50px;
            background-color: #d8d8d8;
            font-size: 18px;
            color: #666;
            outline: none;
            transition: all 0.3s ease;
        }

        .input-field:focus {
            background-color: #ccc;
            color: #333;
        }

        .input-field::placeholder {
            color: #999;
            font-weight: 400;
        }

        .input-field.shake {
            animation: shake 0.5s ease-in-out;
            background-color: #ffcccc;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .next-btn, .signup-btn {
            padding: 22px 40px;
            border: none;
            border-radius: 50px;
            background-color: #4a6fa5;
            color: white;
            font-size: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 40px;
            float: right;
            min-width: 120px;
        }

        .next-btn:hover, .signup-btn:hover {
            background-color: #3d5a8a;
            transform: translateY(-2px);
        }

        .next-btn:disabled, .signup-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .success-screen {
            display: none;
            text-align: center;
            padding-top: 100px;
        }

        .success-screen.show {
            display: block;
            animation: fadeIn 0.8s ease;
        }

        .success-logo {
            font-size: 48px;
            font-weight: 700;
            color: #000;
            margin-bottom: 100px;
            letter-spacing: -1px;
        }

        .success-message {
            font-size: 52px;
            font-weight: 700;
            color: #000;
            text-align: left;
            margin-left: 0;
        }

        .success-message .moment {
            color: #4a6fa5;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .slide-up {
            animation: slideUp 0.5s ease;
        }

        @keyframes slideLeft {
            from {
                transform: translateX(0);
            }
            to {
                transform: translateX(-100%);
                opacity: 0;
            }
        }

        .slide-left {
            animation: slideLeft 0.5s ease forwards;
        }

        @media (max-width: 480px) {
            body {
                padding: 40px 30px;
            }
            
            .logo, .success-logo {
                font-size: 40px;
            }
            
            .signup-title, .success-message {
                font-size: 44px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Main Form -->
        <div id="mainForm">
            <h1 class="logo">Cynvia One</h1>
            <p class="subtitle">Welcome to our community</p>
            <h2 class="signup-title">Sign <span class="up">Up</span></h2>
            
            <div class="form-container">
                <!-- Step 1: Name fields -->
                <div class="form-group" id="firstNameGroup">
                    <input type="text" id="firstName" class="input-field" placeholder="First name" required>
                </div>
                <div class="form-group" id="lastNameGroup">
                    <input type="text" id="lastName" class="input-field" placeholder="Last name" required>
                </div>
                
                <!-- Step 2: Email field -->
                <div class="form-group hidden slide-in-right" id="emailGroup">
                    <input type="email" id="email" class="input-field" placeholder="Email" required>
                </div>
                
                <!-- Step 3: Password fields -->
                <div class="form-group hidden slide-in-right" id="passwordGroup">
                    <input type="password" id="password" class="input-field" placeholder="Password" required>
                </div>
                <div class="form-group hidden slide-in-right" id="confirmPasswordGroup">
                    <input type="password" id="confirmPassword" class="input-field" placeholder="Confirm password" required>
                </div>
                
                <button type="button" id="nextBtn" class="next-btn" disabled>Next</button>
                <button type="button" id="signupBtn" class="signup-btn hidden" style="display: none;" disabled>Sign up</button>
            </div>
        </div>

        <!-- Success Screen -->
        <div id="successScreen" class="success-screen">
            <h1 class="success-logo">OurUI</h1>
            <h2 class="success-message">Just a <span class="moment">moment...</span></h2>
        </div>
    </div>

    <script type="module">
    // Firebase + signup actions
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js';
    import {
      getAuth,
      createUserWithEmailAndPassword,
      updateProfile,
      reload
    } from 'https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js';
    import {
      getFirestore,
      doc,
      setDoc,
      serverTimestamp
    } from 'https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyDaRo6aKcg5Tju7spWUtLKOUBEItUpgF90",
      authDomain: "ouruiofficial.firebaseapp.com",
      projectId: "ouruiofficial",
      storageBucket: "ouruiofficial.firebasestorage.app",
      messagingSenderId: "513335403025",
      appId: "1:513335403025:web:b965e1187d5386d52d87b0",
      measurementId: "G-X5QWNP8DMK"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let currentStep = 1;
    const maxSteps = 3;

    const firstName = document.getElementById('firstName');
    const lastName = document.getElementById('lastName');
    const email = document.getElementById('email');
    const password = document.getElementById('password');
    const confirmPassword = document.getElementById('confirmPassword');
    const nextBtn = document.getElementById('nextBtn');
    const signupBtn = document.getElementById('signupBtn');

    // Helper: get query param (for prefill)
    function getQueryParam(name) {
      const params = new URLSearchParams(window.location.search);
      return params.get(name);
    }

    // Prefill email if ?email= present
    const prefillEmail = getQueryParam('email');
    if (prefillEmail) {
      // If email step is hidden, set value anyway so when user reaches it it's already filled
      email.value = decodeURIComponent(prefillEmail);
    }

    // Enable/disable next button based on current step
    function checkCurrentStepValidity() {
        let isValid = false;
        
        switch(currentStep) {
            case 1:
                isValid = firstName.value.trim() !== '' && lastName.value.trim() !== '';
                break;
            case 2:
                isValid = email.value.trim() !== '' && email.checkValidity();
                break;
            case 3:
                isValid = password.value.trim() !== '' && confirmPassword.value.trim() !== '' && 
                         password.value === confirmPassword.value;
                break;
        }
        
        if (currentStep < 3) {
            nextBtn.disabled = !isValid;
        } else {
            signupBtn.disabled = !isValid;
        }
    }

    // Add event listeners for validation
    [firstName, lastName, email, password, confirmPassword].forEach(input => {
        input.addEventListener('input', checkCurrentStepValidity);
        input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                if (currentStep < 4 && !nextBtn.disabled) {
                    nextStep();
                } else if (currentStep === 4 && !signupBtn.disabled) {
                    completeSignup();
                }
            }
        });
    });

    function nextStep() {
        // Check if current step is valid
        switch(currentStep) {
            case 1: 
                if (firstName.value.trim() === '' || lastName.value.trim() === '') {
                    if (firstName.value.trim() === '') shakeField(firstName);
                    if (lastName.value.trim() === '') shakeField(lastName);
                    return;
                }
                break;
            case 2: 
                if (email.value.trim() === '' || !email.checkValidity()) {
                    shakeField(email);
                    return;
                }
                break;
            case 3: 
                if (password.value.trim() === '' || confirmPassword.value.trim() === '') {
                    if (password.value.trim() === '') shakeField(password);
                    if (confirmPassword.value.trim() === '') shakeField(confirmPassword);
                    return;
                }
                if (password.value !== confirmPassword.value) {
                    shakeField(password);
                    shakeField(confirmPassword);
                    return;
                }
                break;
        }

        if (currentStep >= maxSteps) return;

        // Slide current fields to the left and show next ones from right
        switch(currentStep) {
            case 1:
                // Both name fields slide left, email comes from right
                document.getElementById('firstNameGroup').classList.add('slide-left');
                document.getElementById('lastNameGroup').classList.add('slide-left');
                setTimeout(() => {
                    document.getElementById('firstNameGroup').classList.add('hidden');
                    document.getElementById('lastNameGroup').classList.add('hidden');
                    document.getElementById('emailGroup').classList.remove('hidden');
                    document.getElementById('emailGroup').classList.add('slide-in-right');
                    setTimeout(() => {
                        document.getElementById('emailGroup').classList.add('show');
                        email.focus();
                    }, 50);
                }, 250);
                break;
            case 2:
                // Email slides left, password fields come from right
                document.getElementById('emailGroup').classList.add('slide-left');
                setTimeout(() => {
                    document.getElementById('emailGroup').classList.add('hidden');
                    document.getElementById('passwordGroup').classList.remove('hidden');
                    document.getElementById('confirmPasswordGroup').classList.remove('hidden');
                    document.getElementById('passwordGroup').classList.add('slide-in-right');
                    document.getElementById('confirmPasswordGroup').classList.add('slide-in-right');
                    setTimeout(() => {
                        document.getElementById('passwordGroup').classList.add('show');
                        document.getElementById('confirmPasswordGroup').classList.add('show');
                        password.focus();
                        
                        // Switch to signup button
                        nextBtn.style.display = 'none';
                        signupBtn.style.display = 'inline-block';
                        signupBtn.classList.remove('hidden');
                    }, 50);
                }, 250);
                break;
        }

        currentStep++;
        setTimeout(() => {
            checkCurrentStepValidity();
        }, 300);
    }

    function shakeField(field) {
        field.classList.add('shake');
        setTimeout(() => {
            field.classList.remove('shake');
        }, 500);
    }

    // Password policy check
    function passwordValid(pwd) {
      if (!pwd) return false;
      if (pwd.length < 8) return false;
      // must contain at least one letter
      if (!/[A-Za-z]/.test(pwd)) return false;
      return true;
    }

    async function performSignupFlow() {
      // validations already checked earlier but double-check password policy
      const pwd = password.value.trim();
      if (!passwordValid(pwd)) {
        alert('Password must be at least 8 characters and contain at least one letter.');
        shakeField(password);
        shakeField(confirmPassword);
        // show form back
        document.getElementById('successScreen').classList.remove('show');
        document.getElementById('mainForm').style.display = '';
        return;
      }

      const fName = firstName.value.trim();
      const lName = lastName.value.trim();
      const em = email.value.trim().toLowerCase();

      try {
        // create auth user
        const cred = await createUserWithEmailAndPassword(auth, em, pwd);
        const user = cred.user;

        // set displayName
        const displayName = `${fName} ${lName}`.trim();
        await updateProfile(user, { displayName });

        // write user profile document to Firestore
        await setDoc(doc(db, 'users', user.uid), {
          uid: user.uid,
          email: user.email,
          firstName: fName,
          lastName: lName,
          displayName,
          createdAt: serverTimestamp()
        });

        // force reload user so profile fields are present, then redirect
        try {
          await reload(user);
        } catch (_) {
          // ignore reload failure - we can still redirect after setDoc
        }

        // done — go to index
        window.location.href = 'index.html';
      } catch (err) {
        // show friendly messages and revert UI so user can fix
        document.getElementById('successScreen').classList.remove('show');
        document.getElementById('mainForm').style.display = '';

        const code = err.code || '';
        let msg = err.message || String(err);
        if (code === 'auth/email-already-in-use') {
          msg = 'This email is already in use. Try signing in instead.';
          const goSignIn = confirm(msg + '\n\nClick OK to go to Sign in page.');
          if (goSignIn) window.location.href = `signin.html?email=${encodeURIComponent(email.value.trim())}`;
          return;
        }
        if (code === 'auth/invalid-email') {
          msg = 'Invalid email address.';
          shakeField(email);
        }
        if (code === 'auth/weak-password') {
          msg = 'Weak password. Make sure it is at least 8 characters and contains a letter.';
          shakeField(password); shakeField(confirmPassword);
        }
        alert('❌ ' + msg);
      }
    }

    function completeSignup() {
        // Check if passwords match and are filled
        if (password.value.trim() === '' || confirmPassword.value.trim() === '') {
            if (password.value.trim() === '') shakeField(password);
            if (confirmPassword.value.trim() === '') shakeField(confirmPassword);
            return;
        }
        if (password.value !== confirmPassword.value) {
            shakeField(password);
            shakeField(confirmPassword);
            return;
        }

        // password policy
        if (!passwordValid(password.value.trim())) {
          alert('Password must be at least 8 characters and contain at least one letter.');
          shakeField(password); shakeField(confirmPassword);
          return;
        }

        // Hide main form and show success screen
        document.getElementById('mainForm').style.display = 'none';
        document.getElementById('successScreen').classList.add('show');

        // start firebase signup flow; successScreen remains visible until profile is created
        performSignupFlow();
    }

    // Next button click handler
    nextBtn.addEventListener('click', nextStep);
    
    // Signup button click handler
    signupBtn.addEventListener('click', completeSignup);

    // Initialize
    firstName.focus();
    checkCurrentStepValidity();
    </script>
</body>
</html>
