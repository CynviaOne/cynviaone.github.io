<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>CynviaOne</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #ffffff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 24px;
            background-color: #ffffff;
        }

        .logo {
            font-size: 24px;
            font-weight: 600;
            color: #000000;
        }

        .help-icon {
            width: 28px;
            height: 28px;
            background-color: #000000;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ffffff;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }

        /* Main Content */
        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 80px 24px 40px;
            max-width: 400px;
            margin: 0 auto;
            width: 100%;
        }

        .welcome-title {
            font-size: 32px;
            font-weight: 600;
            color: #000000;
            text-align: center;
            margin-bottom: 16px;
            line-height: 1.2;
        }

        .subtitle {
            font-size: 18px;
            color: #6c757d;
            text-align: center;
            margin-bottom: 48px;
            line-height: 1.4;
        }

        /* Form */
        .form {
            width: 100%;
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
            min-height: 140px;
        }

        .form-step {
            width: 100%;
            transition: all 0.4s cubic-bezier(.2,.9,.2,1);
        }

        .form-step.hidden {
            opacity: 0;
            transform: translateX(-100%);
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            pointer-events: none;
        }

        .form-step.entering {
            opacity: 0;
            transform: translateX(100%);
        }

        .form-step.active {
            opacity: 1;
            transform: translateX(0);
            position: relative;
            pointer-events: all;
        }

        .input-group {
            margin-bottom: 16px;
        }

        .input-field, select.input-field {
            width: 100%;
            padding: 16px 20px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            background-color: #f1f3f4;
            transition: background-color 0.15s ease-in-out;
            font-family: inherit;
        }

        select.input-field {
            cursor: pointer;
            appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="8"><path fill="%235f6368" d="M6 8L0 2h12z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 20px center;
            background-size: 12px;
        }

        .input-field::placeholder {
            color: #5f6368;
        }

        .input-field:focus {
            outline: none;
            background-color: #e8f0fe;
        }

        .error {
            background-color: #fce8e6 !important;
        }

        .next-button {
            width: 100%;
            padding: 16px;
            background-color: #007bff;
            color: #ffffff;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s ease-in-out;
            margin-bottom: 32px;
            opacity: 1;
        }

        .next-button:hover {
            background-color: #0056b3;
        }

        .next-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .signin-link {
            text-align: center;
            font-size: 16px;
            color: #6c757d;
            margin-bottom: 48px;
        }

        .signin-link a {
            color: #007bff;
            text-decoration: none;
            font-weight: 500;
        }

        .signin-link a:hover {
            text-decoration: underline;
        }

        .password-container {
            position: relative;
        }

        .password-container .input-field {
            padding-right: 60px;
        }

        .show-password {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #5f6368;
            cursor: pointer;
            font-size: 14px;
            user-select: none;
            background: none;
            border: none;
            padding: 6px 8px;
            line-height: 1;
        }

        .show-password:focus {
            outline: none;
        }

        .divider {
            display: flex;
            align-items: center;
            width: 100%;
            margin-bottom: 32px;
            color: #adb5bd;
            font-size: 14px;
        }

        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background-color: #e9ecef;
        }

        .divider span {
            padding: 0 16px;
        }

        .google-signin {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 40px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .google-signin:hover {
            transform: scale(1.05);
        }

        .google-icon {
            width: 48px;
            height: 48px;
            background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHZpZXdCb3g9IjAgMCA0OCA0OCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjQiIGN5PSIyNCIgcj0iMjQiIGZpbGw9IndoaXRlIiBzdHJva2U9IiNlOWVjZWYiLz4KPHBhdGggZD0iTTM1LjMyIDI0LjU0NjFDMzUuMzIgMjMuNjQ2MSAzNS4yNDMgMjIuNzg5NCAzNS4xMDkgMjEuOTc2MUgyNC4xNDFWMjYuNzM5NEgzMC4yMDlDMjkuOTMgMjguMDQ2MSAyOS4xNjMgMjkuMDgwMSAyOC4xIDI5Ljc4NjFWMzIuNTQ2MUgzMS44NjRDMzMuNzM4IDMwLjg0NjEgMzUuMzIgMjcuOTQ2MSAzNS4zMiAyNC41NDYxWiIgZmlsbD0iIzQyODVGNCIvPgo8cGF0aCBkPSJNMjQuMTQxIDM1LjIwNjFDMjcuMTQxIDM1LjIwNjEgMjkuNjY0IDM0LjI3NTggMzEuODY0IDMyLjU0NjFMMjguMSAyOS43ODYxQzI3LjIzNyAzMC4zODYxIDI2LjA5MSAzMC43MDYxIDI0LjE0MSAzMC43MDYxQzIxLjI2NCAzMC43MDYxIDE4LjgwNSAyOC45NjYxIDE3Ljk0MiAyNi41MzMxSDEzLjk5N1YyOS4zOTMxQzE2LjE5MyAzMy43NDYxIDI5Ljc5IDM1LjIwNjEgMjQuMTQxIDM1LjIwNjFaIiBmaWxsPSIjMzRBODUzIi8+CjxwYXRoIGQ9Ik0xNy45NDIgMjYuNTMzMUMxNy42NjMgMjUuNzMzMSAxNy41MDkgMjQuOTA2MSAxNy41MDkgMjQuMDQ2MUMxNy41MDkgMjMuMTg2MSAxNy42NjMgMjIuMzU5MSAxNy45NDIgMjEuNTU5MVYxOC42OTkxSDEzLjk5N0MxMy4xMzQgMjAuMzk5MSAxMi42NCAyMi4xODYxIDEyLjY0IDI0LjA0NjFDMTIuNjQgMjUuOTA2MSAxMy4xMzQgMjcuNjkzMSAxMy45OTcgMjkuMzkzMUwxNy45NDIgMjYuNTMzMVoiIGZpbGw9IiNGQkJDMDUiLz4KPHBhdGggZD0iTTI0LjE0MSAxNy4zODYxQzI2LjI0MSAxNy4zODYxIDI4LjA4MSAxOC4xMzkxIDI5LjUwNSAxOS40ODYxTDMyLjkwNSAxNi4wODYxQzMwLjY2MyAxNC4wMDYxIDI3LjY2MyAxMi44ODYxIDI0LjE0MSAxMi44ODYxQzE5Ljc5IDEyLjg4NjEgMTYuMTkzIDE1LjM0NjEgMTMuOTk3IDE4LjY5OTFMMTcuOTQyIDIxLjU1OTFDMTguODA1IDE5LjEyNjEgMjEuMjY0IDE3LjM4NjEgMjQuMTQxIDE3LjM4NjFaIiBmaWxsPSIjRUE0MzM1Ii8+Cjwvc3ZnPgo=');
            background-size: contain;
            margin-bottom: 12px;
            border-radius: 50%;
        }

        .google-text {
            font-size: 16px;
            color: #6c757d;
            font-weight: 500;
        }

        .footer {
            text-align: center;
            padding: 20px;
            font-size: 14px;
            color: #adb5bd;
        }

        .footer a {
            color: #adb5bd;
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        .footer-separator {
            margin: 0 8px;
        }

        /* Network Error Toast (Bottom Popup) */
        .network-toast {
            position: fixed;
            bottom: -200px;
            left: 50%;
            transform: translateX(-50%);
            background: #ffffff;
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.25);
            z-index: 10000;
            min-width: 320px;
            max-width: calc(100vw - 40px);
            transition: bottom 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            text-align: center;
            border: 1px solid #e0e0e0;
        }

        .network-toast.show {
            bottom: 30px;
        }

        .network-toast .message {
            font-size: 16px;
            color: #333;
            font-weight: 600;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        .network-toast .close-btn {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 32px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 80px;
        }

        .network-toast .close-btn:hover {
            background-color: #0056b3;
        }

        .network-toast .close-btn:active {
            transform: translateY(1px);
        }

        /* Loading state */
        .loading {
            position: relative;
            overflow: hidden;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { left: -100%; }
            100% { left: 100%; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">CynviaOne</div>
        <div class="help-icon">?</div>
    </div>

    <div class="container">
        <h1 class="welcome-title">Welcome to CynviaOne</h1>
        <p class="subtitle">Create your CynviaOne account.</p>

        <form class="form" id="signupForm" autocomplete="off">
            <!-- Step 1: Name fields -->
            <div class="form-step active" id="step1">
                <div class="input-group">
                    <input type="text" class="input-field" placeholder="Name" id="firstName" required />
                </div>
                <div class="input-group">
                    <input type="text" class="input-field" placeholder="Last name" id="lastName" required />
                </div>
            </div>

            <!-- Step 2: Email and Password -->
            <div class="form-step hidden" id="step2">
                <div class="input-group">
                    <input type="email" class="input-field" placeholder="E-mail" id="email" required />
                </div>
                <div class="input-group password-container">
                    <input type="password" class="input-field" placeholder="Password" id="password" required />
                    <button type="button" class="show-password" onclick="togglePassword()" aria-label="Toggle password visibility">Show</button>
                </div>
            </div>

            <!-- Step 3: Display name and Country -->
            <div class="form-step hidden" id="step3">
                <div class="input-group">
                    <input type="text" class="input-field" placeholder="Display name" id="displayName" required />
                </div>
                <div class="input-group">
                    <input type="text" class="input-field" placeholder="Country" id="country" required />
                </div>
            </div>

            <!-- Step 4: Birthday and Gender -->
            <div class="form-step hidden" id="step4">
                <div class="input-group">
                    <input type="text" class="input-field" placeholder="Birthday" id="birthday" required />
                </div>
                <div class="input-group">
                    <select class="input-field" id="gender" required>
                        <option value="" disabled selected>Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                        <option value="prefer-not-to-say">Prefer not to say</option>
                    </select>
                </div>
            </div>
        </form>

        <button class="next-button" id="nextBtn" onclick="nextStep()">Next</button>

        <div class="signin-link">
            Already have an account? <a href="#" onclick="showSignIn()">Sign in</a>
        </div>

        <div class="divider">
            <span>——— Supported Service for continue ———</span>
        </div>

        <div class="google-signin" onclick="signInWithGoogle()">
            <div class="google-icon"></div>
            <div class="google-text">Google</div>
        </div>
    </div>

    <div class="footer">
        <a href="#">About</a>
        <span class="footer-separator">|</span>
        <a href="#">Privacy policy</a>
    </div>

    <!-- Network Error Toast -->
    <div class="network-toast" id="networkToast">
        <div class="message">Network error. Please try again later</div>
        <button class="close-btn" onclick="hideNetworkToast()">Ok</button>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDaRo6aKcg5Tju7spWUtLKOUBEItUpgF90",
            authDomain: "cynviaone.github.io",
            projectId: "ouruiofficial",
            storageBucket: "ouruiofficial.appspot.com",
            messagingSenderId: "513335403025",
            appId: "1:513335403025:web:b965e1187d5386d52d87b0",
            measurementId: "G-X5QWNP8DMK"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentStep = 1;
        const totalSteps = 4;
        let userData = {};

        // Form step navigation
        function nextStep() {
            const currentStepElement = document.getElementById(`step${currentStep}`);
            
            // Validate current step
            const inputs = currentStepElement.querySelectorAll('input[required], select[required]');
            let isValid = true;
            
            // Clear previous errors
            inputs.forEach(input => input.classList.remove('error'));
            
            inputs.forEach(input => {
                if (!input.value || !input.value.trim()) {
                    isValid = false;
                    input.classList.add('error');
                }
                
                // Email validation
                if (input.type === 'email' && input.value) {
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(input.value)) {
                        isValid = false;
                        input.classList.add('error');
                    }
                }
                
                // Password validation (min 6 chars)
                if (input.type === 'password' && input.value) {
                    if (input.value.length < 6) {
                        isValid = false;
                        input.classList.add('error');
                        showNetworkToast('Password must be at least 6 characters long');
                        return false;
                    }
                }
            });

            if (!isValid) {
                showNetworkToast('Please fill in all required fields correctly');
                
                // Remove error styling after 3 seconds
                setTimeout(() => {
                    inputs.forEach(input => input.classList.remove('error'));
                }, 3000);
                return;
            }

            // Store current step data
            storeStepData();

            if (currentStep < totalSteps) {
                // Hide current step with animation
                currentStepElement.classList.remove('active');
                currentStepElement.classList.add('hidden');

                // Show next step
                currentStep++;
                const nextStepElement = document.getElementById(`step${currentStep}`);
                nextStepElement.classList.remove('hidden');
                nextStepElement.classList.add('entering');

                // Trigger animation
                setTimeout(() => {
                    nextStepElement.classList.remove('entering');
                    nextStepElement.classList.add('active');
                }, 50);

                // Update button text on last step
                if (currentStep === totalSteps) {
                    document.getElementById('nextBtn').textContent = 'Create Account';
                }
            } else {
                // Final step - create account
                createAccount();
            }
        }

        function storeStepData() {
            const currentStepElement = document.getElementById(`step${currentStep}`);
            const inputs = currentStepElement.querySelectorAll('input, select');
            
            inputs.forEach(input => {
                if (input.value) {
                    userData[input.id] = input.value;
                }
            });
        }

        async function createAccount() {
            const nextBtn = document.getElementById('nextBtn');
            nextBtn.disabled = true;
            nextBtn.classList.add('loading');
            nextBtn.textContent = 'Creating Account...';

            try {
                // Create user with email and password
                const userCredential = await auth.createUserWithEmailAndPassword(userData.email, userData.password);
                const user = userCredential.user;

                // Update user profile
                await user.updateProfile({
                    displayName: userData.displayName || `${userData.firstName} ${userData.lastName}`
                });

                // Save additional user data to Firestore
                await db.collection('users').doc(user.uid).set({
                    uid: user.uid,
                    email: userData.email,
                    firstName: userData.firstName,
                    lastName: userData.lastName,
                    displayName: userData.displayName,
                    country: userData.country,
                    birthday: userData.birthday,
                    gender: userData.gender,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    authProvider: 'email'
                });

                // Success
                showSuccessMessage();
                
            } catch (error) {
                console.error('Error creating account:', error);
                let errorMessage = 'Failed to create account. Please try again.';
                
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = 'Email address is already in use.';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = 'Password is too weak.';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Invalid email address.';
                }
                
                showNetworkToast(errorMessage);
                
                // Reset button
                nextBtn.disabled = false;
                nextBtn.classList.remove('loading');
                nextBtn.textContent = 'Create Account';
            }
        }

        async function signInWithGoogle() {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                provider.addScope('profile');
                provider.addScope('email');
                
                const result = await auth.signInWithPopup(provider);
                const user = result.user;
                
                // Check if user is new
                const userDoc = await db.collection('users').doc(user.uid).get();
                
                if (!userDoc.exists) {
                    // Save new Google user data to Firestore
                    await db.collection('users').doc(user.uid).set({
                        uid: user.uid,
                        email: user.email,
                        displayName: user.displayName,
                        firstName: user.displayName?.split(' ')[0] || '',
                        lastName: user.displayName?.split(' ').slice(1).join(' ') || '',
                        photoURL: user.photoURL,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        authProvider: 'google'
                    });
                }
                
                showSuccessMessage();
                
            } catch (error) {
                console.error('Error signing in with Google:', error);
                
                if (error.code !== 'auth/popup-closed-by-user') {
                    showNetworkToast('Failed to sign in with Google. Please try again.');
                }
            }
        }

        function showSuccessMessage() {
            // Hide all form content
            document.querySelector('.container').innerHTML = `
                <div style="text-align: center; padding: 80px 24px;">
                    <div style="width: 80px; height: 80px; background: #28a745; border-radius: 50%; margin: 0 auto 24px; display: flex; align-items: center; justify-content: center;">
                        <svg width="40" height="40" fill="white" viewBox="0 0 24 24">
                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/>
                        </svg>
                    </div>
                    <h2 style="font-size: 24px; font-weight: 600; color: #000; margin-bottom: 16px;">Account Created Successfully!</h2>
                    <p style="font-size: 16px; color: #6c757d; margin-bottom: 32px;">Welcome to CynviaOne. You can now start using your account.</p>
                    <button onclick="location.reload()" style="background: #007bff; color: white; border: none; padding: 12px 32px; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer;">Continue</button>
                </div>
            `;
        }

        function showSignIn() {
            showNetworkToast('Sign in functionality would be implemented here');
        }

        function togglePassword() {
            const passwordField = document.getElementById('password');
            const showButton = document.querySelector('.show-password');

            if (!passwordField) return;

            if (passwordField.type === 'password') {
                passwordField.type = 'text';
                showButton.textContent = 'Hide';
            } else {
                passwordField.type = 'password';
                showButton.textContent = 'Show';
            }
        }

        // Birthday field behavior
        const birthdayInput = document.getElementById('birthday');
        if (birthdayInput) {
            birthdayInput.addEventListener('focus', function() {
                this.type = 'date';
            });

            birthdayInput.addEventListener('blur', function() {
                if (!this.value) {
                    this.type = 'text';
                }
            });
        }

        // Network Toast Functions
        function showNetworkToast(message = 'Network error. Please try again later') {
            const toast = document.getElementById('networkToast');
            const messageElement = toast.querySelector('.message');
            
            if (!toast || !messageElement) return;
            
            messageElement.textContent = message;
            toast.classList.add('show');
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                hideNetworkToast();
            }, 5000);
        }

        function hideNetworkToast() {
            const toast = document.getElementById('networkToast');
            if (toast) {
                toast.classList.remove('show');
            }
        }

        // Network status monitoring
        function handleOnline() {
            console.log('Back online');
            hideNetworkToast();
        }

        function handleOffline() {
            console.log('Gone offline');
            showNetworkToast('You are offline. Please check your internet connection.');
        }

        // Event listeners
        window.addEventListener('online', handleOnline);
        window.addEventListener('offline', handleOffline);

        // Check initial network status
        if (!navigator.onLine) {
            setTimeout(() => showNetworkToast('You are offline. Please check your internet connection.'), 1000);
        }

        // Auth state observer
        auth.onAuthStateChanged((user) => {
            if (user) {
                console.log('User signed in:', user);
            } else {
                console.log('User signed out');
            }
        });

        // Form submission prevention
        document.getElementById('signupForm').addEventListener('submit', function(e) {
            e.preventDefault();
            nextStep();
        });

        // Enter key support
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                nextStep();
            }
        });
    </script>
</body>
</html>
