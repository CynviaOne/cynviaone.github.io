<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Personal Info - Per User Avatar</title>
<style>
  :root {
    --accent: #007aff;
    --card: #f5f5f5;
    --title: #000;
  }
  body {
    font-family: sans-serif;
    margin: 0;
    background: var(--card);
  }
  .modal-actions {
    display: flex;
    justify-content: flex-end;
    gap: 12px;
    padding: 16px 20px;
    border-top: 1px solid rgba(0,0,0,0.06);
    background: #fff;
    position: sticky;
    bottom: 0;
  }
  .btn {
    padding: 10px 18px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
  }
  .btn-primary {
    background: var(--accent);
    color: #fff;
  }
  .btn-secondary {
    background: var(--card);
    color: var(--title);
  }
  /* other existing styles for your personal info UI */
</style>
</head>
<body>
  <!-- Your personal info HTML structure -->
  <div id="profilePictureContainer">
    <div id="profilePicture" class="profile-pic"></div>
    <input type="file" id="uploadProfilePic" accept="image/*" style="display:none" />
  </div>
  
  <!-- Example modal structure -->
  <div id="nameModal" class="modal" style="display:none">
    <div class="modal-content">
      <h2>Edit Name</h2>
      <input type="text" id="nameInput" />
      <div class="modal-actions">
        <button class="btn btn-secondary" onclick="closeModal('nameModal')">Cancel</button>
        <button class="btn btn-primary" onclick="saveName()">Save</button>
      </div>
    </div>
  </div>

  <!-- Include Firebase auth + per-user avatar logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDaRo6aKcg5Tju7spWUtLKOUBEItUpgF90",
      authDomain: "ouruiofficial.firebaseapp.com",
      projectId: "ouruiofficial",
      storageBucket: "ouruiofficial.firebasestorage.app",
      messagingSenderId: "513335403025",
      appId: "1:513335403025:web:b965e1187d5386d52d87b0",
      measurementId: "G-X5QWNP8DMK"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const profilePictureEl = document.getElementById('profilePicture');
    const uploadInput = document.getElementById('uploadProfilePic');

    function setProfilePicture(imgDataUrl, fallbackInitial) {
      if (imgDataUrl) {
        profilePictureEl.innerHTML = `<img src="${imgDataUrl}" alt="Profile" style="width:100%;height:100%;border-radius:50%;object-fit:cover;">`;
      } else {
        profilePictureEl.textContent = (fallbackInitial || 'U').charAt(0).toUpperCase();
      }
    }

    onAuthStateChanged(auth, (user) => {
      if (user) {
        const uid = user.uid || (user.email ? user.email.replace(/[^a-z0-9]/gi, '_') : 'anon');
        const perUserKey = 'ourui_profilePicture_' + uid;
        const pic = localStorage.getItem(perUserKey) || localStorage.getItem('ourui_profilePicture');
        setProfilePicture(pic, (user.displayName || user.email || 'U').charAt(0));
        localStorage.setItem('ourui_lastUserUid', uid);
      } else {
        profilePictureEl.textContent = 'U';
        localStorage.removeItem('ourui_lastUserUid');
      }
    });

    profilePictureEl.addEventListener('click', () => uploadInput.click());
    uploadInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(evt) {
          const user = auth.currentUser;
          if (user) {
            const uid = user.uid || user.email.replace(/[^a-z0-9]/gi, '_');
            const perUserKey = 'ourui_profilePicture_' + uid;
            localStorage.setItem(perUserKey, evt.target.result);
            localStorage.setItem('ourui_profilePicture', evt.target.result);
            setProfilePicture(evt.target.result);
          }
        };
        reader.readAsDataURL(file);
      }
    });

    function closeModal(id) {
      document.getElementById(id).style.display = 'none';
    }
    function saveName() {
      // implement name save logic
      closeModal('nameModal');
    }
  </script>
</body>
</html>
