<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CynviaOne â€” Sign up (Google only)</title>
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:#e9e9e9;color:#111;min-height:100vh}
  .container{max-width:420px;margin:0 auto;padding:18px}
  .header{display:flex;justify-content:space-between;align-items:center;padding:12px 4px}
  .logo{font-weight:700;font-size:22px}
  .help{width:36px;height:36px;border-radius:50%;background:#000;color:#fff;display:flex;align-items:center;justify-content:center}
  .card{background:transparent;padding:18px;border-radius:8px;text-align:center}
  h1{font-size:34px;margin:30px 0 6px}
  p.subtitle{color:#9aa0a6;margin-bottom:16px}
  .google-btn{display:inline-flex;align-items:center;gap:12px;padding:12px 18px;border-radius:12px;background:#fff;border:1px solid #ddd;cursor:pointer}
  .google-logo{width:34px;height:34px;border-radius:4px;display:flex;align-items:center;justify-content:center;font-weight:700}
  .signin-note{margin-top:18px}
  .divider{height:1px;background:rgba(0,0,0,0.06);margin:22px 0}

  /* bottom popup */
  .bottom-popup-wrap{position:fixed;left:0;right:0;top:0;bottom:0;display:flex;align-items:flex-end;justify-content:center;pointer-events:none;z-index:1200;padding:18px}
  .bottom-popup{width:100%;max-width:420px;background:#fff;border-radius:18px;padding:20px 22px;text-align:center;box-shadow:0 18px 40px rgba(0,0,0,.25);transform:translateY(140%);transition:transform .42s cubic-bezier(.2,.9,.3,1),opacity .28s;opacity:0;pointer-events:auto}
  .bottom-popup.show{transform:translateY(0);opacity:1}
  .bottom-popup .msg{font-size:18px;font-weight:700;margin-bottom:12px}
  .bottom-popup .ok{background:transparent;border:none;color:#0b63d6;font-weight:700;font-size:18px;cursor:pointer}

  /* overlay (transparent black) */
  .overlay{position:fixed;left:0;right:0;top:0;bottom:0;background:rgba(0,0,0,0.45);z-index:1300;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .28s}
  .overlay.show{opacity:1;pointer-events:auto}

  /* compact header when popup/overlay active */
  .header.compact{padding:6px 4px}

</style>
</head>
<body>
  <div class="overlay" id="overlay" aria-hidden="true"></div>

  <div class="container">
    <div class="header" id="header">
      <div class="logo">CynviaOne</div>
      <div class="help">?</div>
    </div>

    <div class="card" id="card">
      <h1>Welcome to CynviaOne</h1>
      <p class="subtitle">Create your CynviaOne account.</p>

      <div style="margin-top:8px">
        <button id="googleBtn" class="google-btn" aria-label="Continue with Google">
          <div class="google-logo" aria-hidden="true">G</div>
          <div>Continue with Google</div>
        </button>
      </div>

      <div class="signin-note">Already have an account? <a href="#" onclick="return false">Sign in</a></div>

      <div class="divider"></div>
      <div class="small" style="color:#9aa0a6;font-size:13px">This demo uses Firebase client-side only. Make sure your domain is added to Firebase authorized domains.</div>
    </div>
  </div>

  <!-- bottom popup -->
  <div class="bottom-popup-wrap" id="bottomWrap" aria-hidden="true">
    <div class="bottom-popup" id="bottomPopup" role="dialog" aria-live="polite">
      <div class="msg" id="popupMsg">Network error. Please try again later</div>
      <div class="sub" id="popupSub"></div>
      <button class="ok" id="popupOk">Ok</button>
    </div>
  </div>

<script type="module">
/*
  Full JS is placed here at bottom as requested.
  - Transparent overlay shows briefly when UI changes.
  - Google sign-in via Firebase popup.
  - Network offline/online bottom popup with rise up/down animation.
*/

/* ----------------- CONFIG ----------------- */
const firebaseConfig = {
  apiKey: "AIzaSyDaRo6aKcg5Tju7spWUtLKOUBEItUpgF90",
  authDomain: "ouruiofficial.firebaseapp.com",
  projectId: "ouruiofficial",
  storageBucket: "ouruiofficial.firebasestorage.app",
  messagingSenderId: "513335403025",
  appId: "1:513335403025:web:b965e1187d5386d52d87b0",
  measurementId: "G-X5QWNP8DMK"
};

/* ----------------- FIREBASE IMPORTS ----------------- */
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

/* ----------------- INIT ----------------- */
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* ----------------- UI ELEMENTS ----------------- */
const googleBtn = document.getElementById('googleBtn');
const overlay = document.getElementById('overlay');
const header = document.getElementById('header');
const bottomWrap = document.getElementById('bottomWrap');
const bottomPopup = document.getElementById('bottomPopup');
const popupMsg = document.getElementById('popupMsg');
const popupSub = document.getElementById('popupSub');
const popupOk = document.getElementById('popupOk');

let popupVisible = false;

/* ----------------- Overlay behavior ----------------- */
function showOverlay(ms = 800) {
  overlay.classList.add('show');
  header.classList.add('compact');
  setTimeout(() => {
    overlay.classList.remove('show');
    header.classList.remove('compact');
  }, ms);
}

/* Show overlay when page starts to indicate UI change */
window.addEventListener('load', () => {
  // show a quick overlay to mimic the "transparent black screen showing second you change UI"
  showOverlay(700);
});

/* ----------------- Bottom popup (network & errors) ----------------- */
function showBottomPopup(message, sub='') {
  popupMsg.textContent = message || 'Network error. Please try again later';
  popupSub.textContent = sub || '';
  bottomWrap.setAttribute('aria-hidden', 'false');
  bottomPopup.classList.add('show');
  popupVisible = true;
}
function hideBottomPopup() {
  bottomPopup.classList.remove('show');
  bottomWrap.setAttribute('aria-hidden', 'true');
  popupVisible = false;
}
popupOk.addEventListener('click', hideBottomPopup);
/* make clicking overlay do nothing so popup only closes via Ok */
bottomWrap.addEventListener('click', e => e.stopPropagation());
bottomPopup.addEventListener('click', e => e.stopPropagation());

/* Network detection */
function handleOffline() {
  showBottomPopup('You are offline', 'Connect to the internet to continue');
}
function handleOnline() {
  // only hide if it was an offline message
  if (popupVisible && popupMsg.textContent.toLowerCase().includes('offline')) {
    hideBottomPopup();
    showBottomPopup('Back online','Connection restored');
    setTimeout(hideBottomPopup, 1200);
  }
}
window.addEventListener('offline', handleOffline);
window.addEventListener('online', handleOnline);

/* initial check */
if (!navigator.onLine) handleOffline();

/* ----------------- Google Sign-In ----------------- */
const provider = new GoogleAuthProvider();

googleBtn.addEventListener('click', async (e) => {
  try {
    // show overlay briefly to indicate a UI change / popup
    showOverlay(600);
    // Open Google sign-in popup
    const result = await signInWithPopup(auth, provider);
    const user = result.user;
    // Save user into Firestore permanently (merge if exists)
    await setDoc(doc(db, 'users', user.uid), {
      displayName: user.displayName || '',
      email: user.email || '',
      photoURL: user.photoURL || '',
      lastSignIn: serverTimestamp()
    }, { merge: true }).catch(err=>{
      console.error('Firestore save error', err);
    });
    showBottomPopup('Signed in', 'Welcome ' + (user.displayName || user.email || 'user'));
    setTimeout(()=> hideBottomPopup(), 1400);
  } catch (err) {
    console.error('Google sign-in failed', err);
    const message = err && err.message ? err.message : 'Google sign-in canceled or blocked';
    showBottomPopup('Google sign-in error', message);
  }
});

/* ----------------- Auth state monitoring ----------------- */
onAuthStateChanged(auth, (user) => {
  if (user) {
    // simple welcome UI update
    const card = document.getElementById('card');
    card.innerHTML = `
      <div style="padding:22px;text-align:center">
        <h2 style="margin-bottom:6px">Welcome, ${user.displayName || user.email || 'User'}</h2>
        <div style="color:#9aa0a6;margin-bottom:16px">You are signed in.</div>
        <div style="display:flex;gap:12px;justify-content:center">
          <button id="signoutBtn" class="google-btn">Sign out</button>
        </div>
      </div>
    `;
    document.getElementById('signoutBtn').addEventListener('click', async ()=>{
      try {
        await auth.signOut();
        showBottomPopup('Signed out','You have been signed out');
        setTimeout(()=> location.reload(), 900);
      } catch (err) {
        showBottomPopup('Sign out error', err.message || '');
      }
    });
  } else {
    // not signed in
  }
});

/* ----------------- End of JS ----------------- */
</script>
</body>
</html>