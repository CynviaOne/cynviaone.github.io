<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>CynviaOne – Notifications</title>

<!-- Roboto -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500,700&display=swap" rel="stylesheet">
<!-- Material Symbols Rounded (filled) -->
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,600,1,0" rel="stylesheet">

<!-- OneSignal SDK -->
<script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async></script>

<style>
:root{--bg:#fbf9fb;--card:#e6e4e7;--muted:#a7a5a6;--title:#0b0b0b;--accent:#3f5f90;--radius:18px;--max-w:380px;--icon-size-lg:32px;--icon-size-md:24px;--icon-slot:44px;--gap-22:18px}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:var(--bg);font-family:"Roboto",system-ui,Arial;color:var(--title);-webkit-font-smoothing:antialiased}
.wrap{max-width:var(--max-w);margin:8px auto;padding:8px 12px 40px}
.material-rounded{font-family: 'Material Symbols Rounded';font-variation-settings: "FILL" 1, "wght" 600, "GRAD" 0, "opsz" 40;display:inline-block;line-height:1;vertical-align:middle}
.icon-sm{font-size:14px}.icon-md{font-size:var(--icon-size-md)}.icon-lg{font-size:var(--icon-size-lg)}
.topbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px}.left{display:flex;align-items:center;gap:8px}
.btn-close{background:transparent;border:0;padding:0;margin:0;font-size:18px;cursor:pointer;color:var(--title);display:inline-flex;align-items:center;justify-content:center}
.btn-close:focus{outline:2px solid rgba(0,0,0,0.08);outline-offset:2px;border-radius:6px}
.logo{font-weight:700;font-size:20px;line-height:1}.logo .one{color:var(--accent);font-weight:600}
.actions{display:flex;gap:12px;align-items:center}.action-icon{background:transparent;border:0;padding:6px;font-size:24px;cursor:pointer;color:var(--title)}
.action-icon:focus{outline:2px solid rgba(0,0,0,0.06);outline-offset:2px;border-radius:6px}
.page-header{padding:16px 2px 20px}.page-header h1{margin:0 0 8px;font-size:32px;font-weight:700;line-height:1.1}
.page-header .subtitle{margin:0 0 12px;font-size:16px;font-weight:600;color:var(--title)}
.page-header .description{margin:0;font-size:14px;line-height:1.4;color:var(--title);opacity:0.8;font-weight:400}

/* Main toggle section */
.main-toggle-section{background:var(--card);border-radius:var(--radius);padding:20px;margin-bottom:var(--gap-22);display:flex;align-items:center;justify-content:space-between}
.main-toggle-content h2{margin:0 0 4px;font-size:20px;font-weight:700;color:var(--title)}
.main-toggle-content p{margin:0;font-size:14px;color:var(--muted);font-weight:400}

/* Toggle switch */
.toggle-switch{width:56px;height:32px;background:var(--muted);border-radius:16px;position:relative;cursor:pointer;transition:background-color 0.3s ease}
.toggle-switch.active{background:var(--accent)}
.toggle-switch .toggle-knob{width:28px;height:28px;background:#fff;border-radius:50%;position:absolute;top:2px;left:2px;transition:transform 0.3s ease;box-shadow:0 2px 4px rgba(0,0,0,0.2)}
.toggle-switch.active .toggle-knob{transform:translateX(24px)}

/* Notification settings */
.notification-section{background:var(--card);border-radius:var(--radius);padding:14px;margin-bottom:var(--gap-22)}
.notification-item{display:flex;align-items:center;gap:14px;padding:12px 0;position:relative}
.notification-item:first-child{padding-top:0}.notification-item:last-child{padding-bottom:0}
.notification-item + .notification-item::before{content:"";display:block;position:absolute;left:-14px;right:-14px;height:4px;top:-6px;background:var(--bg);border-radius:2px}
.notification-item .icon{width:var(--icon-slot);height:var(--icon-slot);display:flex;align-items:center;justify-content:center;flex-shrink:0}
.notification-item .content{flex:1}.notification-item h3{margin:0 0 3px;font-size:16px;font-weight:600;color:var(--title)}
.notification-item p{margin:0;font-size:13px;font-weight:400;color:var(--muted);line-height:1.3}
.notification-item .toggle-switch{width:48px;height:28px;flex-shrink:0}
.notification-item .toggle-switch .toggle-knob{width:24px;height:24px}
.notification-item .toggle-switch.active .toggle-knob{transform:translateX(20px)}

/* Status indicator */
.status-section{background:var(--card);border-radius:var(--radius);padding:20px;margin-bottom:var(--gap-22);text-align:center}
.status-icon{width:64px;height:64px;margin:0 auto 16px;background:var(--accent);border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-size:32px}
.status-section h3{margin:0 0 8px;font-size:18px;font-weight:700;color:var(--title)}
.status-section p{margin:0;font-size:14px;color:var(--muted);line-height:1.4}

/* Footer note */
.footer-note{text-align:center;padding:20px 0;color:var(--muted);font-size:13px}

/* Loading states */
.loading{opacity:0.5;pointer-events:none}

@media (max-width:420px){:root{--max-w:100%}.wrap{padding-left:10px;padding-right:10px}}
</style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="left">
        <button class="btn-close" aria-label="Go back" onclick="goBack()">
          <span class="material-rounded icon-md">arrow_back</span>
        </button>
        <div class="logo">Cynvia<span class="one">One</span></div>
      </div>
      <div class="actions" aria-hidden="true">
        <button class="action-icon" title="Help" aria-label="Help" onclick="window.location.href='mailto:support.cynviaone@outlook.com'">
          <span class="material-rounded icon-md">help</span>
        </button>
      </div>
    </div>

    <div class="page-header">
      <h1>Notifications</h1>
      <p class="subtitle">Manage your notification preferences</p>
      <p class="description">Control how and when you receive notifications from CynviaOne.</p>
    </div>

    <!-- Main notification toggle -->
    <div class="main-toggle-section">
      <div class="main-toggle-content">
        <h2>Push Notifications</h2>
        <p>Get updates and alerts from CynviaOne</p>
      </div>
      <div class="toggle-switch" id="mainToggle" role="switch" aria-checked="false" tabindex="0">
        <div class="toggle-knob"></div>
      </div>
    </div>

    <!-- Status section -->
    <div class="status-section" id="statusSection">
      <div class="status-icon" id="statusIcon">
        <span class="material-rounded">notifications_off</span>
      </div>
      <h3 id="statusTitle">Notifications Disabled</h3>
      <p id="statusDescription">Enable notifications to stay updated with the latest changes and updates.</p>
    </div>

    <!-- Notification settings (shown when enabled) -->
    <div class="notification-section" id="notificationSettings" style="display:none;">
      <div class="notification-item">
        <div class="icon"><span class="material-rounded icon-lg">update</span></div>
        <div class="content">
          <h3>App Updates</h3>
          <p>Get notified about new features and improvements</p>
        </div>
        <div class="toggle-switch active" id="updateToggle" role="switch" aria-checked="true" tabindex="0">
          <div class="toggle-knob"></div>
        </div>
      </div>

      <div class="notification-item">
        <div class="icon"><span class="material-rounded icon-lg">security</span></div>
        <div class="content">
          <h3>Security Alerts</h3>
          <p>Important security notifications and account changes</p>
        </div>
        <div class="toggle-switch active" id="securityToggle" role="switch" aria-checked="true" tabindex="0">
          <div class="toggle-knob"></div>
        </div>
      </div>

      <div class="notification-item">
        <div class="icon"><span class="material-rounded icon-lg">campaign</span></div>
        <div class="content">
          <h3>Promotional</h3>
          <p>Special offers and promotional content</p>
        </div>
        <div class="toggle-switch" id="promoToggle" role="switch" aria-checked="false" tabindex="0">
          <div class="toggle-knob"></div>
        </div>
      </div>
    </div>

    <div class="footer-note">
      Powered by OneSignal • <a href="mailto:support.cynviaone@outlook.com" style="color:var(--accent);text-decoration:none;">Need help?</a>
    </div>
  </div>

  <script>
    // OneSignal configuration
    window.OneSignal = window.OneSignal || [];
    OneSignal.push(function() {
      OneSignal.init({
        appId: "YOUR_ONESIGNAL_APP_ID", // Replace with your actual OneSignal App ID
        allowLocalhostAsSecureOrigin: true,
        notifyButton: {
          enable: false // We're using custom UI
        }
      });
    });

    // State management
    let notificationSettings = {
      main: false,
      updates: true,
      security: true,
      promotional: false
    };

    // UI Elements
    const mainToggle = document.getElementById('mainToggle');
    const updateToggle = document.getElementById('updateToggle');
    const securityToggle = document.getElementById('securityToggle');
    const promoToggle = document.getElementById('promoToggle');
    const statusSection = document.getElementById('statusSection');
    const statusIcon = document.getElementById('statusIcon');
    const statusTitle = document.getElementById('statusTitle');
    const statusDescription = document.getElementById('statusDescription');
    const notificationSettingsSection = document.getElementById('notificationSettings');

    // Initialize UI
    function initializeUI() {
      updateMainToggleUI();
      updateSettingToggleUI('updates', updateToggle);
      updateSettingToggleUI('security', securityToggle);
      updateSettingToggleUI('promotional', promoToggle);
      updateStatusSection();
      
      // Check OneSignal permission status
      checkNotificationPermission();
    }

    // Update main toggle UI
    function updateMainToggleUI() {
      const isActive = notificationSettings.main;
      mainToggle.classList.toggle('active', isActive);
      mainToggle.setAttribute('aria-checked', isActive.toString());
    }

    // Update setting toggle UI
    function updateSettingToggleUI(setting, element) {
      const isActive = notificationSettings[setting];
      element.classList.toggle('active', isActive);
      element.setAttribute('aria-checked', isActive.toString());
    }

    // Update status section
    function updateStatusSection() {
      if (notificationSettings.main) {
        statusIcon.innerHTML = '<span class="material-rounded">notifications</span>';
        statusIcon.style.background = 'var(--accent)';
        statusTitle.textContent = 'Notifications Enabled';
        statusDescription.textContent = 'You\'ll receive notifications based on your preferences below.';
        notificationSettingsSection.style.display = 'block';
      } else {
        statusIcon.innerHTML = '<span class="material-rounded">notifications_off</span>';
        statusIcon.style.background = 'var(--muted)';
        statusTitle.textContent = 'Notifications Disabled';
        statusDescription.textContent = 'Enable notifications to stay updated with the latest changes and updates.';
        notificationSettingsSection.style.display = 'none';
      }
    }

    // Check notification permission
    async function checkNotificationPermission() {
      if ('Notification' in window) {
        const permission = Notification.permission;
        if (permission === 'granted' && window.OneSignal) {
          try {
            OneSignal.push(function() {
              OneSignal.isPushNotificationsEnabled().then(function(isEnabled) {
                if (isEnabled !== notificationSettings.main) {
                  notificationSettings.main = isEnabled;
                  updateMainToggleUI();
                  updateStatusSection();
                }
              });
            });
          } catch (e) {
            console.warn('OneSignal check error:', e);
          }
        }
      }
    }

    // Handle main toggle
    async function handleMainToggle() {
      const newState = !notificationSettings.main;
      
      try {
        if (newState) {
          // Enable notifications
          if ('Notification' in window) {
            let permission = Notification.permission;
            
            if (permission === 'default') {
              permission = await Notification.requestPermission();
            }
            
            if (permission === 'granted') {
              // OneSignal subscription
              if (window.OneSignal) {
                OneSignal.push(function() {
                  OneSignal.setSubscription(true);
                  OneSignal.sendTag('notifications_enabled', 'true');
                });
              }
              
              notificationSettings.main = true;
              
              // Show test notification
              setTimeout(() => {
                new Notification('CynviaOne', {
                  body: 'Notifications enabled successfully!',
                  icon: '/favicon.ico'
                });
              }, 500);
              
            } else {
              alert('Please enable notifications in your browser settings to receive updates.');
              return;
            }
          } else {
            alert('Notifications are not supported in this browser.');
            return;
          }
        } else {
          // Disable notifications
          if (window.OneSignal) {
            OneSignal.push(function() {
              OneSignal.setSubscription(false);
              OneSignal.sendTag('notifications_enabled', 'false');
            });
          }
          
          notificationSettings.main = false;
        }
        
        updateMainToggleUI();
        updateStatusSection();
        saveSettings();
        
      } catch (error) {
        console.error('Toggle error:', error);
        alert('There was an error updating notification settings. Please try again.');
      }
    }

    // Handle setting toggles
    function handleSettingToggle(setting, element) {
      notificationSettings[setting] = !notificationSettings[setting];
      updateSettingToggleUI(setting, element);
      
      // Send tags to OneSignal for targeting
      if (window.OneSignal && notificationSettings.main) {
        OneSignal.push(function() {
          OneSignal.sendTag(setting + '_notifications', notificationSettings[setting].toString());
        });
      }
      
      saveSettings();
    }

    // Save settings to localStorage
    function saveSettings() {
      try {
        localStorage.setItem('cynviaone_notifications', JSON.stringify(notificationSettings));
      } catch (e) {
        console.warn('Could not save settings:', e);
      }
    }

    // Load settings from localStorage
    function loadSettings() {
      try {
        const saved = localStorage.getItem('cynviaone_notifications');
        if (saved) {
          notificationSettings = { ...notificationSettings, ...JSON.parse(saved) };
        }
      } catch (e) {
        console.warn('Could not load settings:', e);
      }
    }

    // Event listeners
    mainToggle.addEventListener('click', handleMainToggle);
    mainToggle.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        handleMainToggle();
      }
    });

    updateToggle.addEventListener('click', () => handleSettingToggle('updates', updateToggle));
    updateToggle.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        handleSettingToggle('updates', updateToggle);
      }
    });

    securityToggle.addEventListener('click', () => handleSettingToggle('security', securityToggle));
    securityToggle.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        handleSettingToggle('security', securityToggle);
      }
    });

    promoToggle.addEventListener('click', () => handleSettingToggle('promotional', promoToggle));
    promoToggle.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        handleSettingToggle('promotional', promoToggle);
      }
    });

    // Navigation
    function goBack() {
      if (window.history.length > 1) {
        window.history.back();
      } else {
        window.location.href = 'index.html';
      }
    }

    // Initialize on load
    document.addEventListener('DOMContentLoaded', function() {
      loadSettings();
      initializeUI();
      
      // Check permission status after OneSignal loads
      setTimeout(checkNotificationPermission, 1000);
    });

    // OneSignal event handlers
    OneSignal.push(function() {
      OneSignal.on('subscriptionChange', function(isSubscribed) {
        notificationSettings.main = isSubscribed;
        updateMainToggleUI();
        updateStatusSection();
        saveSettings();
      });
    });
  </script>
</body>
</html>