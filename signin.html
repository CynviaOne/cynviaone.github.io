<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>CynviaOne â€” Login</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Noto+Sans:wght@400;700&display=swap" rel="stylesheet">
    <!-- Material Symbols (help - filled via FILL axis) -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=help" />
    <style>
        :root {
            --blue: #0052CC;
            --gray-light: #F7F8FA;
            --card-bg: #E5E7EB;
            --text-dark: #0A0A0A;
            --text-muted: #333333;
            --header-height: 64px;
        }

        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--gray-light);
            color: var(--text-dark);
            line-height: 1.6;
            padding: 0; /* removed global padding so header can align to full left */
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header placed full-width, logo flush to left, help icon at extreme right */
        header { 
            display: flex; 
            align-items: center; 
            justify-content: space-between;
            padding: 0.5rem 0.75rem; 
            height: var(--header-height);
            width: 100%;
            background: transparent;
        }

        .logo { 
            font-size: 1.25rem; 
            font-weight: 700; 
            font-family: 'Noto Sans', sans-serif; 
            color: var(--text-dark); 
            user-select: none;
        }
        .logo span { color: var(--blue); }

        /* Right-side header group */
        .header-right { display:flex; align-items:center; gap:10px; }

        /* Sign up button - blue filled, full curved */
        .signup-btn {
            display:inline-flex;
            align-items:center;
            justify-content:center;
            background-color:var(--blue);
            color:#fff;
            border-radius:999px;
            padding:8px 14px;
            font-weight:700;
            font-family:'Roboto',sans-serif;
            text-decoration:none;
            border:2px solid transparent;
            cursor:pointer;
            transition:background 0.15s ease, transform 0.06s ease;
            box-shadow: 0 6px 18px rgba(0,82,204,0.12);
        }
        .signup-btn:hover { background:#004299; transform: translateY(-1px); }

        /* Help icon (material symbol) - filled black icon only, no circle.
           Increased size and tappable area as requested.
           Right-side padding removed per your request. */
        .help-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: none;
            padding: 8px 6px;
            border-radius: 6px;
            cursor: pointer;
            margin-right: 0;
        }
        .help-btn .material-symbols-outlined {
            font-variation-settings: "FILL" 1, "wght" 700;
            font-size: 28px; /* increased from 22px to 28px */
            color: #000; /* filled black icon */
            line-height: 1;
            user-select: none;
        }

        /* Centered content container */
        .container { 
            max-width: 480px; 
            margin: 0 auto; 
            padding: 1rem; /* restore padding for inner content */
            width: 100%;
            box-sizing: border-box;
        }

        /* Login Form Container */
        .login-container {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 2rem 1.5rem;
            margin-top: 2rem;
            text-align: center;
            box-shadow: 0 8px 28px rgba(0,0,0,0.06);
        }

        .welcome-title {
            font-size: 2rem;
            font-weight: 700;
            font-family: 'Noto Sans', sans-serif;
            margin-bottom: 0.5rem;
            color: var(--text-dark);
        }

        .welcome-title span {
            color: var(--blue);
        }

        .subtitle {
            color: var(--text-muted);
            font-size: 1rem;
            margin-bottom: 2rem;
        }

        /* Form Styling */
        form { width: 100%; }
        .input-group { margin-bottom: 1rem; text-align:left; }
        .input-field {
            width: 100%;
            padding: 0.75rem 1rem;
            border-radius: 12px;
            border: 2px solid transparent;
            background: #fff;
            font-size: 1rem;
            font-family: 'Roboto', sans-serif;
            transition: all 0.2s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--blue);
            box-shadow: 0 0 0 3px rgba(0, 82, 204, 0.1);
        }

        .password-container { position: relative; }
        .show-password {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-muted);
            font-weight: 600;
            font-size: 0.875rem;
        }

        .show-password:hover {
            color: var(--blue);
        }

        /* Forgot password link - placed right under password field */
        .forgot-row { display:flex; justify-content:flex-end; margin-top:6px; }
        .forgot-row a { font-size:0.9rem; color:var(--blue); text-decoration:none; font-weight:700; }
        .forgot-row a:hover { text-decoration:underline; color:#004299; }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 700;
            border: 2px solid transparent;
            border-radius: 999px;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.2s ease;
            font-family: 'Roboto', sans-serif;
        }

        .btn.primary {
            background-color: var(--blue);
            color: #fff;
            width: 100%;
            margin-top: 0.5rem;
        }

        .btn.primary:hover {
            background-color: #004299;
        }

        .btn.primary:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .divider {
            margin: 2rem 0;
            color: var(--text-muted);
            text-align: center;
            font-size: 0.875rem;
            position: relative;
        }

        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #ddd;
            z-index: 1;
        }

        .divider span {
            background: var(--card-bg);
            padding: 0 1rem;
            position: relative;
            z-index: 2;
        }

        /* Google Sign In */
        .google-signin {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 1rem;
            border-radius: 12px;
            transition: background 0.2s ease;
        }

        .google-signin:hover {
            background: rgba(0, 82, 204, 0.05);
        }

        .google-icon {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background-size: cover;
            margin-bottom: 0.5rem;
            background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHZpZXdCb3g9IjAgMCA0OCA0OCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjQiIGN5PSIyNCIgcj0iMjQiIGZpbGw9IndoaXRlIiBzdHJva2U9IiNlOWVjZWYiLz4KPHBhdGggZD0iTTM1LjMyIDI0LjU0NjFDMzUuMzIgMjMuNjQ2MSAzNS4yNDMgMjIuNzg5NCAzNS4xMDkgMjEuOTc2MUgyNC4xNDFWMjYuNzM5NEgzMC4yMDlDMjkuOTMgMjguMDQ2MSAyOS4xNjMgMjkuMDgwMSAyOC4xIDI5Ljc4NjFWMzIuNTQ2MUgzMS44NjRDMzMuNzM4IDMwLjg0NjEgMzUuMzIgMjcuOTQ2MSAzNS4zMiAyNC41NDYxWiIgZmlsbD0iIzQyODVGNCIvPgo8cGF0aCBkPSJNMjQuMTQxIDM1LjIwNjFDMjcuMTQxIDM1LjIwNjEgMjkuNjY0IDM0LjI3NTggMzEuODY0IDMyLjU0NjFMMjguMSAyOS43ODYxQzI3LjIzNyAzMC4zODYxIDI2LjA5MSAzMC43MDYxIDI0LjE0MSAzMC43MDYxQzIxLjI2NCAzMC43MDYxIDE4LjgwNSAyOC45NjYxIDE3Ljk0MiAyNi41MzMxSDEzLjk5N1YyOS4zOTMxQzE2LjE5MyAzMy43NDYxIDI5Ljc5IDM1LjIwNjEgMjQuMTQxIDM1LjIwNjFaIiBmaWxsPSIjMzFBODUzIi8+CjxwYXRoIGQ9Ik0xNy45NDIgMjYuNTMzMUMxNy42NjMgMjUuNzMzMSAxNy41MDkgMjQuOTA2MSAxNy41MDkgMjQuMDQ2MUMxNy41MDkgMjMuMTg2MSAxNy42NjMgMjIuMzU5MSAxNy45NDIgMjEuNTU5MVYxOC42OTkxSDEzLjk5N0MxMy4xMzQgMjAuMzk5MSAxMi42NCAyMi4xODYxIDEyLjY0IDI0LjA0NjFDMTIuNjQgMjUuOTA2MSAxMy4xMzQgMjcuNjkzMSAxMy45OTcgMjkuMzkzMUwxNy45NDIgMjYuNTMzMVoiIGZpbGw9IiNGQkJDMDUiLz4KPHBhdGggZD0iTTI0LjE0MSAxNy4zODYxQzI2LjI0MSAxNy4zODYxIDI4LjA4MSAxOC4xMzkxIDI5LjUwNSAxOS40ODYxTDMyLjkwNSAxNi4wODYxQzMwLjY2MyAxNC4wMDYxIDI3LjY2MyAxMi44ODYxIDI0LjE0MSAxMi44ODYxQzE5Ljc5IDEyLjg4NjEgMTYuMTkzIDE1LjM0NjEgMTMuOTk3IDE4LjY5OTFMMTcuOTQyIDIxLjU1OTFDMTguODA1IDE5LjEyNjEgMjEuMjY0IDE3LjM4NjEgMjQuMTQxIDE3LjM4NjFaIiBmaWxsPSIjRUE0MzM1Ii8+Cjwvc3ZnPgo=');
        }

        .google-text {
            font-weight: 600;
            color: var(--text-dark);
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 2rem 0 1rem;
            color: var(--text-muted);
            font-size: 0.875rem;
            margin-top: auto;
        }

        .footer a {
            color: var(--blue);
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        /* Modals - Updated to match theme */
        .verify-modal-backdrop {
            position: fixed;
            inset: 0;
            display: none;
            align-items: flex-end;
            justify-content: center;
            background: rgba(0,0,0,0.3);
            z-index: 20000;
            padding: 0 12px 18px;
        }

        .verify-modal-backdrop.show { display: flex; }

        .verify-modal {
            width: 100%;
            max-width: 420px;
            background: var(--card-bg);
            border-radius: 20px;
            padding: 18px 18px 20px;
            box-shadow: 0 18px 36px rgba(0,0,0,0.35);
            text-align: center;
            transform: translateY(0);
            position: relative;
        }

        .verify-modal .sheet-handle {
            width: 44px;
            height: 6px;
            background: #ccc;
            border-radius: 6px;
            margin: 6px auto 10px;
            display: block;
        }

        .verify-modal h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 6px 0;
            color: var(--text-dark);
            font-family: 'Noto Sans', sans-serif;
        }

        .verify-modal p {
            color: var(--text-muted);
            font-size: 0.95rem;
            margin: 0 10px 14px;
            line-height: 1.45;
        }

        .verify-icon {
            width: 160px;
            height: 120px;
            margin: 10px auto 6px;
            display: block;
            object-fit: contain;
        }

        .check-btn {
            background: var(--blue);
            border: 0;
            color: #fff;
            font-weight: 700;
            font-size: 1rem;
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            display: block;
            margin: 6px auto 0;
            border-radius: 999px;
            transition: background 0.2s ease;
        }

        .check-btn:hover {
            background: #004299;
        }

        .small-note {
            color: var(--text-muted);
            font-size: 0.8rem;
            margin-top: 10px;
        }

        /* Rise-up animation */
        .verify-modal-backdrop.show .verify-modal,
        #genericModal.show .verify-modal {
            animation: riseUp 360ms cubic-bezier(.2,.9,.2,1) both;
        }

        @keyframes riseUp {
            0% { transform: translateY(28px); opacity: 0; }
            60% { transform: translateY(-6px); opacity: 1; }
            100% { transform: translateY(0); opacity: 1; }
        }

        @media (min-width: 700px) {
            .login-container { margin-top: 3rem; }
        }
    </style>
</head>
<body>
    <!-- Header moved outside centered container so logo sits at full left -->
    <header>
        <div class="logo">Cynvia<span>One</span></div>
        <div class="header-right">
            <a href="https://account.cynviaone.xo.je/sign-up" class="signup-btn" id="signupBtn" rel="noopener noreferrer" target="_blank">Sign up</a>
            <div class="help-btn" id="helpBtn" title="Help" aria-label="Help">
                <span class="material-symbols-outlined" aria-hidden="true">help</span>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Login Form Container -->
        <div class="login-container">
            <h1 class="welcome-title">Sign in to Cynvia<span>One</span></h1>
            <p class="subtitle">Enter your account details to continue.</p>

            <form id="loginForm" autocomplete="off" onsubmit="return false;">
                <div id="step1" class="step active">
                    <div class="input-group">
                        <input id="email" class="input-field" type="email" placeholder="E-mail" required />
                    </div>
                    <div class="input-group password-container">
                        <input id="password" class="input-field" type="password" placeholder="Password" required />
                        <button type="button" class="show-password" onclick="togglePassword()" aria-label="Toggle password visibility">Show</button>
                    </div>
                    <div class="forgot-row" aria-hidden="false">
                        <a href="#" id="forgotLink">Forgot password?</a>
                    </div>
                </div>

                <button type="button" id="signInBtn" class="btn primary" onclick="signIn()">Sign in</button>
            </form>

            <div class="divider">
                <span>Supported Service for continue</span>
            </div>

            <div class="google-signin" onclick="signInWithGoogle()" role="button" tabindex="0" aria-label="Sign in with Google">
                <div class="google-icon" aria-hidden="true"></div>
                <div class="google-text">Google</div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <a href="about/index.html">About</a> | <a href="privacy-policy/index.html">Privacy policy</a>
        </div>
    </div>

    <!-- Verification modal (bottom sheet) -->
    <div id="verifyModal" class="verify-modal-backdrop" aria-hidden="true">
        <div class="verify-modal" role="dialog" aria-modal="true" aria-labelledby="verifyTitle">
            <div class="sheet-handle" aria-hidden="true"></div>
            <h3 id="verifyTitle">Please verify your email</h3>
            <p id="verifyDesc">Go to inbox in spam folder and verify your email.</p>
            <img src="ic/verifyic.svg" alt="verify icon" class="verify-icon" onerror="this.style.display='none'"/>
            <button id="checkVerifyBtn" class="check-btn" onclick="checkVerification()">Check</button>
            <div class="small-note">If you don't see the email, check your spam/junk folder.</div>
        </div>
    </div>

    <!-- Forgot password modal -->
    <div id="forgotModal" class="verify-modal-backdrop" aria-hidden="true">
        <div class="verify-modal" role="dialog" aria-modal="true" aria-labelledby="forgotTitle">
            <div class="sheet-handle" aria-hidden="true"></div>
            <h3 id="forgotTitle">Reset your password</h3>
            <p id="forgotDesc">We'll send a password reset link to your email address. Enter the email you used to sign in.</p>
            <input id="forgotEmail" class="input-field" type="email" placeholder="your-email@example.com" style="margin-top:8px;" />
            <button id="sendResetBtn" class="check-btn" style="margin-top:12px;">Send reset link</button>
            <div class="small-note" id="forgotNote" style="display:none;"></div>
        </div>
    </div>

    <!-- Generic bottom modal for messages -->
    <div id="genericModal" class="verify-modal-backdrop" aria-hidden="true" style="display:none;">
        <div class="verify-modal" role="dialog" aria-modal="true" aria-labelledby="genericTitle">
            <div class="sheet-handle" aria-hidden="true"></div>
            <h3 id="genericTitle">Message</h3>
            <p id="genericDesc">This is a message.</p>
            <img id="genericIcon" src="ic/verifyic.svg" alt="" class="verify-icon" onerror="this.style.display='none'"/>
            <button id="genericOkBtn" class="check-btn" onclick="hideGenericModal()">Ok</button>
        </div>
    </div>

    <!-- Firebase SDK (compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDaRo6aKcg5Tju7spWUtLKOUBEItUpgF90",
            authDomain: "ouruiofficial.firebaseapp.com",
            projectId: "ouruiofficial",
            storageBucket: "ouruiofficial.firebasestorage.app",
            messagingSenderId: "513335403025",
            appId: "1:513335403025:web:b965e1187d5386d52d87b0",
            measurementId: "G-X5QWNP8DMK"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Determine redirect target
        const params = new URLSearchParams(window.location.search);
        const redirectParam = params.get('redirect');
        let redirectTo = '/u/account/index.html';
        if (redirectParam) {
            redirectTo = redirectParam;
        } else if (document.referrer && document.referrer.startsWith(location.origin)) {
            try { redirectTo = new URL(document.referrer).pathname || redirectTo; } catch(e) {}
        }

        function togglePassword() {
            const p = document.getElementById('password');
            const btn = document.querySelector('.show-password');
            if (!p) return;
            if (p.type === 'password') { p.type = 'text'; btn.textContent = 'Hide'; }
            else { p.type = 'password'; btn.textContent = 'Show'; }
        }

        async function signIn() {
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;

            if (!email || !password) {
                showNetworkToast('Please enter both email and password');
                return;
            }

            const signInBtn = document.getElementById('signInBtn');
            signInBtn.disabled = true;
            signInBtn.textContent = 'Signing in...';

            try {
                const credential = await auth.signInWithEmailAndPassword(email, password);
                const user = credential.user;
                if (user.emailVerified) {
                    window.location.href = redirectTo;
                } else {
                    showVerifyModal();
                }
            } catch (err) {
                console.error('Sign in error', err);
                let msg = 'Unable to sign in. Please check your credentials.';
                if (err.code === 'auth/user-not-found') msg = 'User not found. Please sign up first.';
                else if (err.code === 'auth/wrong-password') msg = 'Incorrect password.';
                else if (err.code === 'auth/invalid-email') msg = 'Invalid email address.';
                showNetworkToast(msg);
            } finally {
                signInBtn.disabled = false;
                signInBtn.textContent = 'Sign in';
            }
        }

        async function signInWithGoogle() {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                provider.addScope('profile');
                provider.addScope('email');

                const result = await auth.signInWithPopup(provider);
                const user = result.user;

                // Save user if new
                const userDoc = await db.collection('users').doc(user.uid).get();
                if (!userDoc.exists) {
                    await db.collection('users').doc(user.uid).set({
                        uid: user.uid,
                        email: user.email,
                        displayName: user.displayName,
                        photoURL: user.photoURL,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        authProvider: 'google'
                    });
                }

                if (user.emailVerified) {
                    window.location.href = redirectTo;
                } else {
                    showVerifyModal();
                }
            } catch (err) {
                console.error('Google sign in error', err);
                if (err.code !== 'auth/popup-closed-by-user') showNetworkToast('Failed to sign in with Google. Please try again.');
            }
        }

        function showVerifyModal() {
            const modal = document.getElementById('verifyModal');
            if (!modal) return;
            modal.style.display = 'flex';
            modal.classList.add('show');
            modal.setAttribute('aria-hidden', 'false');
        }

        async function checkVerification() {
            const btn = document.getElementById('checkVerifyBtn');
            btn.disabled = true;
            btn.textContent = 'Checking...';
            try {
                const user = auth.currentUser;
                if (!user) {
                    showNetworkToast('No user found. Please sign in again.');
                    btn.disabled = false;
                    btn.textContent = 'Check';
                    return;
                }
                await user.reload();
                if (user.emailVerified) {
                    window.location.href = redirectTo;
                    return;
                } else {
                    showNetworkToast('Email not verified yet. Please check your inbox (and spam).');
                    btn.disabled = false;
                    btn.textContent = 'Check';
                }
            } catch (e) {
                console.error(e);
                showNetworkToast('Unable to check verification right now. Try again.');
                btn.disabled = false;
                btn.textContent = 'Check';
            }
        }

        /* ========== FORGOT PASSWORD FLOW ========== */
        document.addEventListener('DOMContentLoaded', function(){
            const forgotLink = document.getElementById('forgotLink');
            if (forgotLink) {
                forgotLink.addEventListener('click', function(e){
                    e.preventDefault();
                    const emailInput = document.getElementById('email');
                    const forgotEmail = document.getElementById('forgotEmail');
                    // Pre-fill with email value if present
                    forgotEmail.value = emailInput.value.trim() || '';
                    openForgotModal();
                });
            }

            const sendResetBtn = document.getElementById('sendResetBtn');
            if (sendResetBtn) {
                sendResetBtn.addEventListener('click', async function(){
                    const btn = document.getElementById('sendResetBtn');
                    const email = document.getElementById('forgotEmail').value.trim();
                    const note = document.getElementById('forgotNote');
                    if(!email){
                        note.style.display = 'block';
                        note.style.color = '#c62828';
                        note.textContent = 'Please enter an email address.';
                        return;
                    }
                    btn.disabled = true;
                    btn.textContent = 'Sending...';
                    try{
                        // send password reset email - include continue URL back to sign-in page
                        await auth.sendPasswordResetEmail(email, {url: window.location.origin + '/signin.html'});
                        note.style.display = 'block';
                        note.style.color = '#1b5e20';
                        note.textContent = 'Reset email sent. Check your inbox and spam folder.';
                        btn.textContent = 'Sent';
                        setTimeout(()=>{ closeForgotModal(); showGenericMessage('Password reset link sent', 'We sent a password reset link to: ' + email + '. Check your inbox (and spam).'); }, 1400);
                    }catch(err){
                        console.error('sendPasswordResetEmail', err);
                        note.style.display = 'block';
                        note.style.color = '#c62828';
                        if(err && err.code === 'auth/user-not-found'){
                            note.textContent = 'No account found for that email.';
                        } else if(err && err.code === 'auth/invalid-email'){
                            note.textContent = 'Invalid email address.';
                        } else {
                            note.textContent = 'Unable to send reset email. Try again later.';
                        }
                        btn.disabled = false;
                        btn.textContent = 'Send reset link';
                    }
                });
            }

            // close forgot modal when clicking backdrop
            const forgotModal = document.getElementById('forgotModal');
            if (forgotModal) {
                forgotModal.addEventListener('click', function(e){
                    if(e.target === this) closeForgotModal();
                });
            }
        });

        function openForgotModal(){
            const modal = document.getElementById('forgotModal');
            if(!modal) return;
            modal.style.display = 'flex';
            modal.classList.add('show');
            modal.setAttribute('aria-hidden','false');
            const input = modal.querySelector('#forgotEmail');
            if(input) setTimeout(()=>input.focus(),60);
            // reset note
            document.getElementById('forgotNote').style.display = 'none';
        }

        function closeForgotModal(){
            const modal = document.getElementById('forgotModal');
            if(!modal) return;
            modal.classList.remove('show');
            modal.style.display = 'none';
            modal.setAttribute('aria-hidden','true');
        }

        /* Generic modal helpers (reuse existing genericModal) */
        function showGenericMessage(title, message){
            const generic = document.getElementById('genericModal');
            const titleEl = document.getElementById('genericTitle');
            const descEl = document.getElementById('genericDesc');
            const iconEl = document.getElementById('genericIcon');

            titleEl.textContent = title || 'Message';
            descEl.textContent = message || '';
            if(iconEl) iconEl.style.display = 'none';
            generic.style.display = 'flex';
            generic.classList.add('show');
            generic.setAttribute('aria-hidden','false');
            setTimeout(()=>{ hideGenericModal(); }, 3600);
        }

        function hideGenericModal() {
            const generic = document.getElementById('genericModal');
            if (!generic) return;
            generic.classList.remove('show');
            generic.style.display = 'none';
            generic.setAttribute('aria-hidden', 'true');
        }

        function showNetworkToast(message='Network error. Please try again later') {
            const verifyBackdrop = document.getElementById('verifyModal');
            const generic = document.getElementById('genericModal');
            const titleEl = document.getElementById('genericTitle');
            const descEl = document.getElementById('genericDesc');
            const iconEl = document.getElementById('genericIcon');

            titleEl.textContent = 'Notice';
            descEl.textContent = message || 'Something happened';

            if (iconEl) iconEl.style.display = 'none';

            if (verifyBackdrop && verifyBackdrop.classList.contains('show')) {
                showQuickInlineToast(message);
                return;
            }

            if (generic) {
                generic.style.display = 'flex';
                generic.classList.add('show');
                generic.setAttribute('aria-hidden', 'false');

                setTimeout(() => { hideGenericModal(); }, 3800);
            } else {
                showQuickInlineToast(message);
            }
        }

        function showQuickInlineToast(message) {
            const existing = document.getElementById('tempToast');
            if (existing) existing.remove();
            const t = document.createElement('div');
            t.id = 'tempToast';
            t.style.position = 'fixed';
            t.style.left = '50%';
            t.style.bottom = '28px';
            t.style.transform = 'translateX(-50%)';
            t.style.background = 'var(--card-bg)';
            t.style.padding = '12px 18px';
            t.style.borderRadius = '12px';
            t.style.boxShadow = '0 8px 30px rgba(0,0,0,0.2)';
            t.style.zIndex = '30000';
            t.style.fontWeight = '700';
            t.style.color = 'var(--text-dark)';
            t.textContent = message;
            document.body.appendChild(t);
            setTimeout(()=>{ t.remove(); }, 3200);
        }

        // Enter key to sign in
        document.addEventListener('keydown', function(e){
            if (e.key === 'Enter') {
                // ignore Enter if focus is on a button to avoid double clicks
                const active = document.activeElement;
                if (active && active.tagName.toLowerCase() === 'button') return;
                signIn();
            }
        });

        // Help icon click -> mailto support
        document.getElementById('helpBtn').addEventListener('click', function(){
            window.location.href = 'mailto:support.cynviaone@outlook.com';
        });

    </script>

</body>
</html>
